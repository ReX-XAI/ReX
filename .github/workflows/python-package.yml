# This workflow will install Python dependencies, run tests and lint with a variety of Python versions
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-python

name: Run tests and checks

on: pull_request

jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.12"]
        poetry-version: ["1.8.3"]

    permissions:
      pull-requests: write
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python, Poetry and Dependencies
      uses: packetcoders/action-setup-cache-python-poetry@v1.2.0
      with:
          python-version: ${{matrix.python-version}}
          poetry-version: ${{matrix.poetry-version}}
          install-args: --with dev
    - run: echo "$(poetry env info --path)/bin" >> $GITHUB_PATH

    - name: Lint with Ruff
      run: |
        ruff check --output-format=github .
    - name: Install ReX
      run: |
        poetry install 
    - name: Test with pytest
      run: |
        pytest --junitxml=pytest.xml --cov-report=xml:coverage.xml --cov=rex_xai tests/
    - name: Pytest coverage comment
      uses: MishaKav/pytest-coverage-comment@v1.1.52
      with:
        pytest-xml-coverage-path: ./coverage.xml
    - name: Type checking with Pyright
      uses: jakebailey/pyright-action@v2
      with:
        working-directory: "./rex-xai/"


